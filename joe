local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

getgenv().webhook = nil
getgenv().cumulativeEarnedCash = 0
getgenv().startingCash = 0

local player = game.Players.LocalPlayer
local dataFolder = player:WaitForChild("DataFolder")

local function sendEmbedWithServerThumbnailAndCurrencyToDiscord()
    if not getgenv().webhook then
        return
    end

    local serverThumbnailUrl = "https://cdn.discordapp.com/icons/1193980576013750433/dbb27f6ecf1f5e6cdffeddd46f4cf717.png?size=1024"

    local formatCurrency = function(amount)
        return string.format("$%s", tostring(amount):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", ""))
    end

    local currencyValue = dataFolder.Currency.Value

    local elapsedTime = os.time() - getgenv().startTime
    local elapsedMinutes = math.floor(elapsedTime / 60)
    local elapsedSeconds = elapsedTime % 60

    local data = {
        embeds = {
            {
                title = "**VARSITYS AUTOFARM**",
                color = 0x9c8cfa,  -- Light Purple
                thumbnail = {
                    url = serverThumbnailUrl
                },
                description = "**Cash Info**\n\n**STARTING WALLET:** " .. formatCurrency(getgenv().startingCash) ..
                              "\n\n**CURRENT CASH:** " .. formatCurrency(currencyValue) ..
                              "\n\n**EARNED CASH:** " .. formatCurrency(getgenv().cumulativeEarnedCash) ..
                              "\n\n**TIME ELAPSED:** " .. string.format("%02d:%02d", elapsedMinutes, elapsedSeconds)
            }
        }
    }

    local headers = {
        ["Content-Type"] = "application/json"
    }

    local encodedData = HttpService:JSONEncode(data)

    local request = {
        Url = getgenv().webhook,
        Method = "POST",
        Headers = headers,
        Body = encodedData
    }

    -- Send the embed message
    HttpService:RequestAsync(request)
end

local delayBetweenEmbeds = 5 -- Set the delay in seconds
local lastExecutionTime = os.time()

RunService.Heartbeat:Connect(function(deltaTime)
    if os.time() - lastExecutionTime >= delayBetweenEmbeds then
        sendEmbedWithServerThumbnailAndCurrencyToDiscord()
        lastExecutionTime = os.time()
    end
end)

-- Set the start time
getgenv().startTime = os.time()
getgenv().startingCash = dataFolder.Currency.Value
