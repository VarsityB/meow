local Link = getgenv().Webhook

local formatCurrency = function(amount)
    return string.format("$%s", tostring(amount):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", ""))
end

local player = game.Players.LocalPlayer
local dataFolder = player:WaitForChild("DataFolder")

-- Initialize cumulativeEarnedCash to 0 if not already set
getgenv().cumulativeEarnedCash = getgenv().cumulativeEarnedCash or 0

-- Function to calculate and send Discord webhook
local function sendWebhook()
    local startingCash = getgenv().startingCash or dataFolder.Currency.Value
    local currentCash = dataFolder.Currency.Value
    local earnedCash = currentCash - startingCash
    getgenv().cumulativeEarnedCash = getgenv().cumulativeEarnedCash + earnedCash

    local data = {
        ["content"] = "",
        ["embeds"] = {{
            ["title"] = "**Varsitys AutoFarm**",
            ["description"] = string.format("**Cash Info**\n\n**Starting Cash:** %s\n**Current Cash:** %s\n**Earned Cash:** %s",
                formatCurrency(startingCash),
                formatCurrency(currentCash),
                formatCurrency(earnedCash)
            ),
            ["color"] = 0x0088FF, -- Blue color
        }}
    }

    local response = request({
        Url = Link,
        Body = game:GetService("HttpService"):JSONEncode(data),
        Method = "POST",
        Headers = {["content-type"] = "application/json"}
    })
end

-- Set startingCash to the initial amount of current cash
getgenv().startingCash = dataFolder.Currency.Value

-- Schedule sending webhooks every 5 seconds
game:GetService("RunService").Heartbeat:Connect(function()
    local currentTime = tick()
    if currentTime - (getgenv().lastWebhookTime or 0) >= 5 then
        sendWebhook()
        getgenv().lastWebhookTime = currentTime
    end
end)
